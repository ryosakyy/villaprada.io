<div class="galeria-page">

    <div class="page-head">
        <div>
            <h2>Galer√≠a de Eventos</h2>
            <p>Gestiona las im√°genes que se mostrar√°n en la vista p√∫blica (Cloudinary)</p>
        </div>

        <button class="btn-purple" (click)="mostrarFormulario = !mostrarFormulario">
            {{ mostrarFormulario ? '‚ùå Cancelar' : 'üì∑ Subir Nueva Imagen' }}
        </button>
    </div>

    <section class="card upload-box" *ngIf="mostrarFormulario">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div class="form-group">
                <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 5px;">T√≠tulo de la imagen *</label>
                <input class="input" style="width: 100%;" [(ngModel)]="tituloNuevo" placeholder="Ej: Mesa Principal Boda" />
            </div>
            <div class="form-group">
                <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 5px;">Categor√≠a</label>
                <select class="input" style="width: 100%;" [(ngModel)]="categoriaNueva">
                    <option value="">Sin categor√≠a</option>
                    <option value="boda">Boda</option>
                    <option value="xv">XV A√±os</option>
                    <option value="corporativo">Corporativo</option>
                    <option value="decoracion">Decoraci√≥n</option>
                </select>
            </div>
        </div>

        <div class="drop-zone" style="position: relative; cursor: pointer; background: #f8fafc;">
            <input type="file" (change)="onFileSelected($event)" style="position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;">
            <div class="icon">üìÅ</div>
            <p *ngIf="!archivoSeleccionado">Haga clic o arrastre para seleccionar una imagen</p>
            <p *ngIf="archivoSeleccionado" style="color: #2563eb;">
                <strong>Seleccionado:</strong> {{ archivoSeleccionado.name }}
            </p>
            <span>Formatos: JPG, PNG, WEBP (M√°x 5MB)</span>
        </div>

        <button class="btn-purple" style="width: 100%; margin-top: 15px; padding: 12px;" (click)="subirImagen()" [disabled]="!archivoSeleccionado || !tituloNuevo">
            üöÄ Confirmar y subir a la Nube
        </button>
    </section>

    <section class="card">
        <div class="filters">
            <input class="input search" [(ngModel)]="terminoBusqueda" (input)="onSearchChange(terminoBusqueda)" placeholder="Buscar por t√≠tulo, categor√≠a o descripci√≥n..." />

            <select class="input small" (change)="obtenerImagenes()">
                <option value="">Todas las fechas</option>
            </select>

            <div class="total">Resultados: <strong>{{ listaImagenes.length }}</strong></div>
        </div>
    </section>

    <section class="grid">
        <div *ngIf="listaImagenes.length === 0" style="grid-column: 1/-1; text-align: center; padding: 40px;">
            <p style="color: #64748b;">No se encontraron im√°genes en la galer√≠a.</p>
        </div>

        <div class="img-card" *ngFor="let item of listaImagenes">
            <div style="position: relative;">
                <img [src]="item.imagen_url" [alt]="item.titulo" loading="lazy">
                <span class="badge green" style="position: absolute; top: 10px; right: 10px;">
                    {{ item.categoria || 'General' }}
                </span>
            </div>

            <div class="img-body">
                <div class="title">{{ item.titulo }}</div>
                <div class="date">Publicado: {{ item.fecha_creacion | date:'dd/MM/yyyy' }}</div>

                <div class="actions">
                    <button class="icon blue" (click)="verImagen(item.imagen_url)" title="Ver pantalla completa">üëÅ</button>
                    <button class="icon red" (click)="borrarImagen(item.id)" title="Eliminar permanentemente">üóë</button>

                    <span style="margin-left: auto; font-size: 10px; color: #94a3b8;">ID: #{{item.id}}</span>
                </div>
            </div>
        </div>
    </section>

    <div class="note">
        ‚ÑπÔ∏è <strong>Consejo:</strong> Las im√°genes subidas aqu√≠ se sincronizan autom√°ticamente con la base de datos de <strong>Villa Prada</strong> y se almacenan de forma segura en <strong>Cloudinary</strong>.
    </div>

</div>